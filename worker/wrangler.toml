name = "mailbox-preview"
main = "src/index.ts"
tsconfig = "tsconfig.json"
compatibility_date = "2025-12-01"
compatibility_flags = ["nodejs_compat"]
account_id = "b3c03e2f679658ac453eacdb31eae290"
workers_dev = true
assets = { directory = "../web/dist", binding = "ASSETS", not_found_handling = "single-page-application", run_worker_first = ["/api/*"] }

[vars]
# Default 30 day retention. Keep API_TOKEN as a secret (wrangler secret put API_TOKEN).
TTL_DAYS = 30

# Preview / staging (wrangler dev / wrangler deploy --env preview)
[[d1_databases]]
binding = "DB"
database_name = "mail_cleaner_db_preview"
database_id = "a632cf6b-cdda-4abf-ac9a-0d52e36a72c8"
preview_database_id = "a632cf6b-cdda-4abf-ac9a-0d52e36a72c8"

[env.production]
# Optionally set a custom route, e.g. "mail-cleaner.example.com/*"
# route = "REPLACE_WITH_ROUTE"
name = "mailbox"
routes = [{ pattern = "mailbox.styleofwong.com", custom_domain = true }]

[[env.production.d1_databases]]
binding = "DB"
database_name = "mail_cleaner_db"
database_id = "a632cf6b-cdda-4abf-ac9a-0d52e36a72c8"
preview_database_id = "a632cf6b-cdda-4abf-ac9a-0d52e36a72c8"

[env.production.vars]
TTL_DAYS = 30

[observability]
enabled = false
head_sampling_rate = 1
